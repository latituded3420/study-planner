let subjects=JSON.parse(localStorage.getItem('subjects'))||[];let sessions=JSON.parse(localStorage.getItem('sessions'))||[];let timerInterval=null;let isRunning=false;let timeLeft=25*60;let isBreak=false;let selectedPriority='medium';function init(){setStudyDate();renderSubjects();loadSessions();attachEventListeners();setupPriorityButtons();}function setupPriorityButtons(){const buttons=document.querySelectorAll('.priority-btn');buttons.forEach(btn=>{btn.addEventListener('click',function(){buttons.forEach(b=>b.classList.remove('active'));this.classList.add('active');selectedPriority=this.getAttribute('data-priority');});if(btn.getAttribute('data-priority')==='medium'){btn.classList.add('active');}});}function attachEventListeners(){document.getElementById('addSubjectBtn').addEventListener('click',addSubject);document.getElementById('generatePlanBtn').addEventListener('click',generatePlan);document.getElementById('startBtn').addEventListener('click',startTimer);document.getElementById('pauseBtn').addEventListener('click',pauseTimer);document.getElementById('resetBtn').addEventListener('click',resetTimer);}function setStudyDate(){let start=document.getElementById('studyStartDate');if(!start.value){let today=new Date().toISOString().split('T')[0];start.value=today;}}function addSubject(){let name=document.getElementById('subjectName').value;let date=document.getElementById('examDate').value;let hrs=parseInt(document.getElementById('studyHours').value);if(!name||!date){alert('Please fill all fields');return;}subjects.push({id:Date.now(),name,examDate:date,priority:selectedPriority,totalHours:hrs,completedHours:0});saveSubjects();renderSubjects();clearSubjectForm();updateProgress();}function renderSubjects(){let list=document.getElementById('subjectsList');if(subjects.length===0){list.innerHTML='<div class="empty-state">No subjects added yet</div>';return;}list.innerHTML='';subjects.forEach(s=>{let priorityColor={'high':'#dc3545','medium':'#ffc107','low':'#28a745'}[s.priority];let priorityText={'high':'High','medium':'Medium','low':'Low'}[s.priority];let card=document.createElement('div');card.className='subject-card';card.innerHTML=`<div class="subject-info"><h4>${s.name}</h4><p>Exam: ${s.examDate} | Priority: ${priorityText} | ${s.totalHours}h needed</p></div><button class="btn-delete" onclick="deleteSubject(${s.id})">Delete</button>`;list.appendChild(card);});updateExamsList();}function deleteSubject(id){subjects=subjects.filter(s=>s.id!==id);saveSubjects();renderSubjects();}function clearSubjectForm(){document.getElementById('subjectName').value='';document.getElementById('examDate').value='';document.getElementById('studyHours').value='20';selectedPriority='medium';const buttons=document.querySelectorAll('.priority-btn');buttons.forEach(btn=>{btn.classList.remove('active');if(btn.getAttribute('data-priority')==='medium')btn.classList.add('active');});}function generatePlan(){let dailyHours=parseInt(document.getElementById('dailyHours').value);if(subjects.length===0||!dailyHours){alert('Add subjects and set daily hours');return;}let plan={};subjects.forEach(s=>{let days=Math.ceil((new Date(s.examDate)-new Date())/(1000*60*60*24));let weight={'high':1.5,'medium':1,'low':0.7}[s.priority]*s.totalHours;plan[s.id]={allocation:weight/subjects.reduce((t,x)=>t+({'high':1.5,'medium':1,'low':0.7}[x.priority]*x.totalHours),0)*dailyHours,daysLeft:days};});let html='';subjects.forEach(s=>{let alloc=plan[s.id].allocation.toFixed(2);html+=`<div class="progress-item"><div class="progress-label"><span>${s.name}</span><span>${alloc}h/day</span></div><div class="progress"><div class="progress-bar" style="width: ${Math.min((alloc/plan[s.id].daysLeft)*100,100)}%"></div></div><p style="margin-top: 5px; color: #666; font-size: 12px;">${plan[s.id].daysLeft} days left</p></div>`;});document.getElementById('planContent').innerHTML=html;document.getElementById('studyPlanDisplay').style.display='block';}function startTimer(){if(isRunning)return;isRunning=true;timerInterval=setInterval(updateTimer,1000);}function pauseTimer(){isRunning=false;clearInterval(timerInterval);}function resetTimer(){isRunning=false;clearInterval(timerInterval);let sessionDuration=parseInt(document.getElementById('sessionDuration').value);timeLeft=sessionDuration*60;updateDisplay();}function updateTimer(){timeLeft--;if(timeLeft<=0){playSound();nextPhase();return;}updateDisplay();}function nextPhase(){pauseTimer();isBreak=!isBreak;let duration=isBreak?parseInt(document.getElementById('breakDuration').value):parseInt(document.getElementById('sessionDuration').value);timeLeft=duration*60;updateDisplay();if(!isBreak){let obj={date:new Date().toLocaleDateString(),type:'study',duration:parseInt(document.getElementById('sessionDuration').value)};sessions.push(obj);saveSessions();loadSessions();}}function updateDisplay(){let mins=Math.floor(timeLeft/60);let secs=timeLeft%60;document.getElementById('timerDisplay').textContent=`${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;}function playSound(){if(document.getElementById('soundToggle').checked){let audioContext=new(window.AudioContext||window.webkitAudioContext)();let oscillator=audioContext.createOscillator();let gain=audioContext.createGain();oscillator.connect(gain);gain.connect(audioContext.destination);oscillator.frequency.value=800;gain.gain.setValueAtTime(0.3,audioContext.currentTime);gain.gain.exponentialRampToValueAtTime(0.01,audioContext.currentTime+0.5);oscillator.start(audioContext.currentTime);oscillator.stop(audioContext.currentTime+0.5);}}function updateProgress(){let total=subjects.reduce((t,s)=>t+s.totalHours,0);let completed=subjects.reduce((t,s)=>t+s.completedHours,0);let pct=total>0?Math.round(completed/total*100):0;document.getElementById('overallPercent').textContent=pct+'%';document.getElementById('overallBar').style.width=pct+'%';}function updateExamsList(){let html='';let upcoming=subjects.filter(s=>new Date(s.examDate)>new Date()).sort((a,b)=>new Date(a.examDate)-new Date(b.examDate)).slice(0,10);if(upcoming.length===0){document.getElementById('upcomingExams').innerHTML='<div class="empty-state">No upcoming exams</div>';return;}upcoming.forEach(s=>{let days=Math.ceil((new Date(s.examDate)-new Date())/(1000*60*60*24));let priority={'high':'High','medium':'Medium','low':'Low'}[s.priority];html+=`<div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;"><h4 style="margin: 0; color: #333;">${s.name}</h4><p style="margin: 5px 0 0 0; color: #666; font-size: 13px;">${days} days left | Priority: ${priority} | ${s.totalHours}h needed</p></div>`;});document.getElementById('upcomingExams').innerHTML=html;}function loadSessions(){let html='';let today=new Date().toLocaleDateString();let todaySessions=sessions.filter(s=>s.date===today);if(todaySessions.length===0){document.getElementById('sessionsList').innerHTML='<div class="empty-state">No sessions today</div>';return;}html=todaySessions.map(s=>`<div style="margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">ðŸ“– ${s.duration}min session</div>`).join('');document.getElementById('sessionsList').innerHTML=html;}function saveSessions(){localStorage.setItem('sessions',JSON.stringify(sessions));}function saveSubjects(){localStorage.setItem('subjects',JSON.stringify(subjects));}document.addEventListener('DOMContentLoaded',init);
