let subjects=JSON.parse(localStorage.getItem('subjects'))||[];let sessions=JSON.parse(localStorage.getItem('sessions'))||[];let timerInterval=null;let isRunning=false;let timeLeft=25*60;let isBreak=false;function init(){setStudyDate();renderSubjects();loadSessions();attachEventListeners()}function attachEventListeners(){document.getElementById('addSubjectBtn').addEventListener('click',addSubject);document.getElementById('generatePlanBtn').addEventListener('click',generatePlan);document.getElementById('startBtn').addEventListener('click',startTimer);document.getElementById('pauseBtn').addEventListener('click',pauseTimer);document.getElementById('resetBtn2').addEventListener('click',resetTimer);document.getElementById('nextBtn').addEventListener('click',nextPhase);document.getElementById('themeToggle').addEventListener('click',toggleTheme);document.getElementById('exportBtn').addEventListener('click',exportData);document.getElementById('importBtn').addEventListener('click',importData);document.getElementById('resetBtn').addEventListener('click',resetAllData);}function setStudyDate(){let start=document.getElementById('studyStartDate');if(!start.value){let today=new Date().toISOString().split('T')[0];start.value=today;}}function addSubject(){let name=document.getElementById('subjectName').value;let date=document.getElementById('examDate').value;let pri=document.getElementById('priority').value;let hrs=parseInt(document.getElementById('studyHours').value);if(!name||!date){alert('Please fill all fields');return;}subjects.push({id:Date.now(),name,examDate:date,priority:pri,totalHours:hrs,completedHours:0});saveSubjects();renderSubjects();clearSubjectForm();updateProgress();}function renderSubjects(){let list=document.getElementById('subjectsList');list.innerHTML='';subjects.forEach(s=>{let card=document.createElement('div');card.className='subject-card';let pri={'high':'ðŸ”´','medium':'ðŸŸ¡','low':'ðŸŸ¢'}[s.priority];card.innerHTML=`<div><strong>${pri} ${s.name}</strong><br/><small>Exam: ${s.examDate}</small></div><button onclick='deleteSubject(${s.id})' class='btn btn-danger btn-sm'>Del</button>`;list.appendChild(card);});updateExamsList();}function deleteSubject(id){subjects=subjects.filter(s=>s.id!==id);saveSubjects();renderSubjects();}function clearSubjectForm(){document.getElementById('subjectName').value='';document.getElementById('examDate').value='';document.getElementById('priority').value='medium';document.getElementById('studyHours').value='20';}function generatePlan(){let dailyHours=parseInt(document.getElementById('dailyHours').value);if(subjects.length===0||!dailyHours){alert('Add subjects and set daily hours');return;}let plan={};subjects.forEach(s=>{let days=Math.ceil((new Date(s.examDate)-new Date())/(1000*60*60*24));let weight={'high':1.5,'medium':1,'low':0.7}[s.priority]*s.totalHours;plan[s.id]={allocation:weight/subjects.reduce((t,x)=>t+({'high':1.5,'medium':1,'low':0.7}[x.priority]*x.totalHours),0)*dailyHours,daysLeft:days};});let html='<div class="row">';subjects.forEach(s=>{let alloc=plan[s.id].allocation.toFixed(2);html+=`<div class="col-md-6 mb-2"><div class="p-2" style="background:#e7f3ff;border-radius:5px"><strong>${s.name}</strong><br/>Daily: ${alloc}h | Days: ${plan[s.id].daysLeft}</div></div>`;});html+='</div>';document.getElementById('planContent').innerHTML=html;document.getElementById('studyPlanDisplay').classList.remove('d-none');}function startTimer(){if(isRunning)return;isRunning=true;timerInterval=setInterval(updateTimer,1000);}function pauseTimer(){isRunning=false;clearInterval(timerInterval);}function resetTimer(){isRunning=false;clearInterval(timerInterval);let session=isBreak?parseInt(document.getElementById('breakDuration').value):parseInt(document.getElementById('sessionDuration').value);timeLeft=session*60;updateDisplay();}function nextPhase(){pauseTimer();isBreak=!isBreak;let duration=isBreak?parseInt(document.getElementById('breakDuration').value):parseInt(document.getElementById('sessionDuration').value);timeLeft=duration*60;updateDisplay();if(!isBreak){let obj={date:new Date().toLocaleDateString(),type:'study',duration:parseInt(document.getElementById('sessionDuration').value)};sessions.push(obj);saveSessions();loadSessions();}}function updateTimer(){timeLeft--;if(timeLeft<=0){playSound();nextPhase();return;}updateDisplay();}function updateDisplay(){let mins=Math.floor(timeLeft/60);let secs=timeLeft%60;document.getElementById('timerDisplay').textContent=`${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;let status=isBreak?'Break Time! â˜•':'Focus Time! ðŸ“š';document.getElementById('timerStatus').textContent=status;}function playSound(){if(document.getElementById('soundToggle').checked){let audioContext=new(window.AudioContext||window.webkitAudioContext)();let oscillator=audioContext.createOscillator();let gain=audioContext.createGain();oscillator.connect(gain);gain.connect(audioContext.destination);oscillator.frequency.value=800;gain.gain.setValueAtTime(0.3,audioContext.currentTime);gain.gain.exponentialRampToValueAtTime(0.01,audioContext.currentTime+0.5);oscillator.start(audioContext.currentTime);oscillator.stop(audioContext.currentTime+0.5);}}function updateProgress(){let total=subjects.reduce((t,s)=>t+s.totalHours,0);let completed=subjects.reduce((t,s)=>t+s.completedHours,0);let pct=total>0?Math.round(completed/total*100):0;document.getElementById('overallPercent').textContent=pct+'%';document.getElementById('overallBar').style.width=pct+'%';}function updateExamsList(){let html='';let upcoming=subjects.filter(s=>new Date(s.examDate)>new Date()).sort((a,b)=>new Date(a.examDate)-new Date(b.examDate)).slice(0,7);upcoming.forEach(s=>{let days=Math.ceil((new Date(s.examDate)-new Date())/(1000*60*60*24));let urgency=days<=7?'urgent':'';html+=`<div class="exam-card ${urgency}"><strong>${s.name}</strong><br/><small>${days} days left | ${s.totalHours}h needed</small></div>`;});document.getElementById('upcomingExams').innerHTML=html||'<p class="text-muted">No upcoming exams</p>';}function loadSessions(){let html='';let today=new Date().toLocaleDateString();let todaySessions=sessions.filter(s=>s.date===today);html=todaySessions.map(s=>`<div class="session-item">ðŸ“– ${s.duration}min session</div>`).join('');document.getElementById('sessionsList').innerHTML=html||'<p class="text-muted">No sessions today</p>';}function saveSessions(){localStorage.setItem('sessions',JSON.stringify(sessions));}function saveSubjects(){localStorage.setItem('subjects',JSON.stringify(subjects));}function toggleTheme(){document.body.classList.toggle('light-mode');localStorage.setItem('theme',document.body.classList.contains('light-mode')?'light':'dark');}function exportData(){let data={subjects,sessions,date:new Date().toISOString()};let json=JSON.stringify(data,null,2);let blob=new Blob([json],{type:'application/json'});let url=URL.createObjectURL(blob);let a=document.createElement('a');a.href=url;a.download='study-planner-'+Date.now()+'.json';a.click();}function importData(){document.getElementById('importFile').click();}function resetAllData(){if(confirm('Are you sure? This will delete all data!')){subjects=[];sessions=[];localStorage.clear();location.reload();}}document.addEventListener('DOMContentLoaded',init);
